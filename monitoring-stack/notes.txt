npm install prom-client #if not

#USING ARGO CD TO RUN PODS
#kubectl port-forward svc/argocd-server -n argocd \
  --address 0.0.0.0 8080:443 

#kubectl port-forward svc/prometheus -n monitoring --address 0.0.0.0 9090:9090


#AFTER THIS WE WILL CREATE NODEPORT FOR Expose Backend metrics

#INSTALL kubectl
sudo apt update -y
sudo apt install -y curl ca-certificates

curl -LO "https://dl.k8s.io/release/$(curl -Ls https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
curl -LO "https://dl.k8s.io/release/$(curl -Ls https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl.sha256"
echo "$(cat kubectl.sha256)  kubectl" | sha256sum --check
chmod +x kubectl
sudo mv kubectl /usr/local/bin/
kubectl version --client

#MINIKUBE
curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
chmod +x minikube-linux-amd64
sudo mv minikube-linux-amd64 /usr/local/bin/minikube
minikube version

#----------------------
#PODS METRICS
#kubectl apply -k github.com/kubernetes/kube-state-metrics/examples/standard
#kubectl get svc -n kube-system | grep kube-state


#Prometheus/Grafana access relies on NodePort

# apiVersion: v1
# kind: ConfigMap
# metadata:
#   name: prometheus-config
#   namespace: monitoring
# data:
#   prometheus.yml: |
#     global:
#       scrape_interval: 15s

#     scrape_configs:
#       # Backend Node.js metrics
#       - job_name: "backend"
#         static_configs:
#           - targets:
#               - backend:3500

#       # Kubernetes pod/state metrics
#       - job_name: "kube-state-metrics"
#         static_configs:
#           - targets:
#               - kube-state-metrics.kube-system.svc.cluster.local:8080

# #kubectl apply -f prometheus-config.yaml

# apiVersion: v1
# kind: Service
# metadata:
#   name: prometheus
#   namespace: monitoring
# spec:
#   type: NodePort
#   selector:
#     app: prometheus
#   ports:
#     - port: 9090
#       targetPort: 9090
#       nodePort: 30900

# kubectl apply -f prometheus-service.yaml

# kubectl get svc -n monitoring


#Connect Grafana â†’ Prometheus
#Import:
#  Node.js backend dashboard
#  Kubernetes pod health dashboard

#Grafana
#11159 NODEJS
#PODS 15760